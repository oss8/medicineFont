"use strict";var validatorRegister,Province,City,isNeedpassword=!0;$(document).ready(function(){function e(){$.ajax({url:"http://restapi.amap.com/v3/ip",dataType:"json",data:{key:configInfo.mapKey},type:"POST",success:function(r){1==r.status?(City=r.city,Province=r.province,console.log(r)):timer=setTimeout(e,1e3)}})}function r(e){var r;return"getSmsBtn"==e.attr("id")&&(r=--n,$.cookie("smsTimer",r,{expires:1}),r<=0)?void a(e):void e.text(r+"秒后重新发送")}function a(e){n=60,e[0].disabled=!1,clearInterval(i),e.text("短信获取验证码"),$.cookie("smsDis",""),e.removeClass("selected")}$.validator.setDefaults({debug:!1}),$.getUrlParam=function(e){var r=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),a=window.location.search.substr(1).match(r);return null!=a?unescape(a[2]):null};var s=$.getUrlParam("username");s&&$("#userName").val(decodeURI(s));var o=$.getUrlParam("mobile");o&&$("#mobile").val(o);var t=$.getUrlParam("brandname");t&&$("#brandName").val(decodeURI(t)),e(),$("#smsCode").change(function(){$("#smsCode").removeData("previousValue").valid()}),validatorRegister=$("#registerForm").validate({rules:{brandName:{required:!0,maxlength:10},userName:{required:!0},smsCode:{required:!0,number:!0,remote:{type:"POST",url:configInfo.baseUrl+"OpPublicAPIs/CheckSendSMS",data:{CheckSendSMS:{mobile:function(){return String($("input[name='mobile']").val())},regcode:function(){return String($("input[name='smsCode']").val())}}},dataFilter:function(e){var r=JSON.parse(e);return console.log("yzm:"),console.log(r),1==r.status}}},mobile:{required:!0,isMobile:!0}},messages:{brandName:{required:"请填写品牌名",maxlength:"品牌最大字数为10位"},userName:{required:"请填写联系人姓名"},smsCode:{required:"请输入验证码",number:"请输入数字",remote:"验证码不正确"},mobile:{required:"请输入手机号码",isMobile:"请填写正确的手机号码"}},focusCleanup:!0,onkeyup:null,focusInvalid:!0,groups:{register:"password smsCode mobile userName brandName"},errorPlacement:function(e,r){$("#registerError").html(e[0].innerHTML)},submitHandler:function(e){if(isNeedpassword===!0){var r=$(e[name="password"]).val();if(r.length<6)return void $("#registerError").html("密码至少6位字符或数字")}var a,s=$(e).find("input, select, button");s.prop("disabled",!0);var o={BrandInfo:{Mobile:$(e[name="mobile"]).val(),PassWord:$(e[name="password"]).val()+"",BrandName:$(e[name="brandName"]).val(),RegCode:$.getUrlParam("regcode"),UserName:$(e[name="userName"]).val(),Province:Province,City:City}};console.log(o),$("#registerError").html(""),a=$.ajax({url:configInfo.baseUrl+"OpRegBrandApis/NewRegisterBrand",type:"post",data:o}),a.done(function(e,r,a){console.log(e),console.log("返回信息"),console.log(e.result),1==e.status?location.href=e.result.JumpURL:0==e.status&&$("#registerError").html(e.result)}),a.fail(function(e,r,a){$("#registerError").html(a),console.log("The following error occured: "+r,a)}),a.always(function(){s.prop("disabled",!1)})}}),$.validator.addMethod("isMobile",function(e,r){var a=e.length,s=/^(13[0-9]{9})|(18[0-9]{9})|(14[0-9]{9})|(17[0-9]{9})|(15[0-9]{9})$/;return this.optional(r)||11==a&&s.test(e)},"请正确填写您的手机号码");var i,n=60,l=$.cookie("smsDis");n<=0&&(n=60),$("#mobile").change(function(){$("#registerError").html("")}),$("#getSmsBtn").click(function(){var e=$(this),s=$("input[name='mobile']").val();return 0==s.length?void $("#registerError").html("请输入手机号码"):($("input[name='smsCode']").val(""),"smsDis"==l?(e.addClass("selected"),$("#getSmsBtn")[0].disabled="disabled",i=setInterval(function(){r($("#getSmsBtn"))},1e3)):e[0].disabled||(e[0].disabled="disabled",e.addClass("selected"),$.cookie("smsDis","smsDis",{expires:1}),i=setInterval(function(){r(e)},1e3)),void $.ajax({url:configInfo.baseUrl+"OpPublicAPIs/CheckRegBrandMobile/",dataType:"json",data:{SendSMS:{mobile:s}},type:"POST",success:function(r){console.info(r),1==r.status?0==r.result.ClosePassword?($("#password").attr("placeholder","请设置登录密码"),$("#password").attr("disabled",!1),$("#password").removeClass("invalid"),isNeedpassword=!0):($("#password").val(""),$("#password").attr("placeholder","该手机已注册，将使用原密码登录"),$("#password").attr("disabled",!0),$("#password").addClass("invalid"),isNeedpassword=!1):a(e)},error:function(r){a(e)}}))})});